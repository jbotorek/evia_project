<% provide(:title, @route.title) %>
<% content_for :showcase do %>
<script type="text/javascript">
    var detailOn = false;
    $(window).load(function(){
    fitGalleryThumbs(); 
    });
    $(document).ready(function(){
        $('.panels').hide();
        if(window.location.hash==""){
            window.location.hash="info";
        }
        var hash = window.location.hash;
        $(hash).fadeIn();
        checkWhetherRenderMap(hash);
        $('.switch a').click(function(){
            $('.panels').hide();
            $(this.hash).fadeIn();
            checkWhetherRenderMap(this.hash);
        });
    });
    function checkWhetherRenderMap(hash){
        if(hash=="#maps"){
            initMap();
        }
    }
    function fitGalleryThumbs(){
        $('.gallery_thumb').find('img').each(function(){ 
            var thumbWidth = $('.gallery_thumb').css('width').match(/([0-9]+)/)[0];
            var thumbHeight = $('.gallery_thumb').css('height').match(/([0-9]+)/)[0];
            var originalWidth = this.width;
            var originalHeight = this.height;
            var imgClass = ((this.width-thumbWidth)/(this.height-thumbHeight) > 1) ? 'wide' : 'tall';
            if((this.width/thumbWidth)/(this.height/thumbHeight) > 1){
                $(this).width("auto").height(thumbHeight+"px");
                ratio = originalHeight/thumbHeight;
                $(this).css('margin-left',-(originalWidth/ratio-thumbWidth)/2);
            }else{
                $(this).width(thumbWidth+"px").height("auto");
                ratio = originalWidth/thumbWidth;
                $(this).css('margin-top',-(originalHeight/ratio-thumbHeight)/2);
            }
        });
    }
</script>    
    <div class="switch summary_part">
        <span class="half_horizontally">
            <span class="half_horizontally"><a href="#info">Info</a></span>
            <span class="half_horizontally"><a href="#maps">Map</a></span>
        </span>
        <span class="half_horizontally">
            <span class="half_horizontally"><a href="#gallery">Gallery</a></span>
            <span class="half_horizontally"><a href="#comments">Comments</a></span>
        </span>
    </div>
    <div class="wanna_try"><%= render 'routes/try_button' %>
	</div>
    
    <%= render 'routedetails' %>
    <div id="gallery" class="panels">
        <% if current_user.tried?(@route) %>
		<div class="nic">
			<h2>Add a photo:</h2>		
			<%= form_for :file_upload, :html => {:multipart => true} do |f| %>
			  <%= hidden_field_tag :route_id, :value => @route.id %>
			  <%= hidden_field_tag :user_id, :value => @user.id %>
			  <%= f.file_field 'upload', :multiple => true%>
			  <%= f.submit "Upload" %>
			<% end %>			
		<div>
	<% end %>
		<h3>Photos by:</h3>
		<% @allgalerists.each do |gal| %> 
            <% photo = @thumbnails[gal.id] %>
            <div class="gallery_entry"> 
                    <%= link_to :controller => :routes, :action => :photogallery, :user_id => gal.id, :route_id => @route.id  do %> 
                       <div class="gallery_thumb"><%= image_tag('photogalleries/' + photo.id.to_s+ '/' + photo.image_file_name, :alt => photo.image_file_name) %></div>
                        <span><%= gal.email%></span>
                    <% end %>
            </div>
        <% end %>
            <div class="clear"> </div>
    </div>
    <div class="clear"> </div>
    <div class="detail_field">
        <span class="half_horizontally"><%= render 'want_try' %></span>
        <span class="half_horizontally"><%= render 'tried' %></span>
    </div>
    <div id="comments" class="panels">
        <div class="form">
            <%= render 'route_new_comment' %>
        </div>
        <div class="comment_stream">
            <%= render 'route_comments_stream' %>
        </div>
    </div>
    <%= link_to 'Back', @user ,:class => "back_button", :title => 'Go back to your profile page' %>
<% end %>
